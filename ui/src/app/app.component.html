
<div id="divContainer">
    <h1 class="mat-h1">
        Harry Potter - Wizards Unite Fortress Simulator v{{packageJsonVersion}} <br>
        <a target="_blank" href="https://github.com/Zhadok/HP_WU_FortressSim">(source code and documentation)</a>
    </h1>

    
    <div id="divStartSimulationContainer">
            <button (click)="onClickButtonStartSingleSimulation()" class="buttonStartSimulation" mat-raised-button large color="primary" >
                Start single simulation
            </button>
            <button (click)="onClickButtonStartMultipleSimulations_compareRoomLevels()" class="buttonStartSimulation" mat-raised-button large color="primary" >
                Simulate different room levels
            </button>
            <button (click)="onClickButtonStartMultipleSimulations_compareSkillTreeNodes()" class="buttonStartSimulation" mat-raised-button large color="primary" >
                Simulate skill tree upgrades
            </button>
                
        </div>

    <mat-accordion [multi]="true">
        <!--<h2 class="mat-h2">Input parameters</h2> -->
        <mat-expansion-panel #matPanelInputParameters [expanded]="true">
                <mat-expansion-panel-header>
                    <mat-panel-title>
                        Input parameters
                    </mat-panel-title>
                    <mat-panel-description>
                        Choose between your skill tree and directly entering stats
                    </mat-panel-description>
                </mat-expansion-panel-header>

                <div id="divSettingsRoomLevel">
                    <h2 class="mat-h2">Overall parameters: </h2>
                    <mat-form-field class="inputRoomLevel" appearance="outline">
                        <mat-label>Room level: {{getChamberName(simParameters.roomLevel)}}</mat-label>
                        <input type="number" min="1" max="20" matInput placeholder="Room level" name="roomLevel"
                                    [(ngModel)]="simParameters.roomLevel">
                    </mat-form-field>
                </div>

                <mat-tab-group id="matTabGroupWizardSettings">
                    <mat-tab label="Skill Tree"> 
                        <div id="divSkillTreeSettingsWrapper">
                            <div *ngFor="let nameClass of simParameters.nameClasses; let playerIndex=index" class="divSingleWizardSettings">
                                <h2 class="mat-h2">Settings for player {{playerIndex+1}}</h2>
                                
                                <mat-form-field appearance="outline">
                                    <mat-label>Class</mat-label>
                                    <mat-select placeholder="Select class..." name="selectWizardClass" 
                                                (selectionChange)="onChangeSelectWizardClass($event, playerIndex)"
                                                [(ngModel)]="simParameters.nameClasses[playerIndex]"
                                                class="inputPotion">
                                                
                                        <mat-option *ngFor="let item of allowedClasses | keyvalue" value="{{item.key}}">{{item.value}}</mat-option>
                                    </mat-select>
                                </mat-form-field>
            
                                <h2 class="mat-h2">Skill tree: </h2>
                                <div class="divSkillTree">
                                    <!-- https://teropa.info/blog/2016/12/12/graphics-in-angular-2.html -->
                                    <svg width="100%" [attr.height]="skillTreeVis.marginTop + skillTreeVis.rowHeight*20" [attr.viewBox]="[0,0,
                                        skillTreeVis.marginLeft + skillTreeVis.columnWidth*5,
                                        skillTreeVis.marginTop + skillTreeVis.rowHeight*20]">
                                        <defs>
                                            <pattern id="deteriorationHex" x="0" y="0" height="10" width="10">
                                                <image xlink:href="assets/img/deteriorationHex.png" x="0" y="0"></image>
                                            </pattern>
                                        </defs>

                                        <g *ngFor="let node of skillTrees[playerIndex].nodesStudied | keyvalue">
                                            <line *ngFor="let dependency of getDependenciesFromSkillTreeNode(node.key.dependencies)"
                                                [attr.x1]="dependency.columnIndex * skillTreeVis.columnWidth + skillTreeVis.marginLeft*2" 
                                                [attr.y1]="dependency.rowIndex * skillTreeVis.rowHeight + skillTreeVis.marginTop*2" 
                                                [attr.x2]="node.key.columnIndex * skillTreeVis.columnWidth + skillTreeVis.marginLeft*2" 
                                                [attr.y2]="node.key.rowIndex * skillTreeVis.rowHeight + skillTreeVis.marginTop*2" 
                                                stroke="black"
                                            />
                                        </g>
            
                                        <g *ngFor="let node of skillTrees[playerIndex].nodesStudied | keyvalue">
                                            <text [attr.x]="node.key.columnIndex * skillTreeVis.columnWidth + skillTreeVis.marginLeft*2" 
                                                [attr.y]="node.key.rowIndex * skillTreeVis.rowHeight + skillTreeVis.marginTop*2 - skillTreeVis.nodeCircleRadius/2 - 20" 
                                                text-anchor="middle"
                                                class="textSkillTreeNodeName">{{node.key.name}}</text>
                                            <circle [attr.cx]="node.key.columnIndex * skillTreeVis.columnWidth + skillTreeVis.marginLeft*2"
                                                    [attr.cy]="node.key.rowIndex * skillTreeVis.rowHeight + skillTreeVis.marginTop*2"
                                                    [attr.r]="skillTreeVis.nodeCircleRadius" stroke="black"
                                                    [attr.fill]="node.value===node.key.levels.length ? 'yellowgreen' : 'gray'"
                                                    (click)="onClickSkillTreeNode(node.key, playerIndex)"
                                                    matTooltip="{{getSkillTreeNodeTooltip(node.key)}}"
                                                    [matTooltipClass]="'myMatTooltip'"
                                                    
                                                    ></circle>
                                            <text [attr.x]="node.key.columnIndex * skillTreeVis.columnWidth + skillTreeVis.marginLeft*2" 
                                                  [attr.y]="node.key.rowIndex * skillTreeVis.rowHeight + skillTreeVis.marginTop*2 + 6" 
                                                  class="textSkillTreeNode" text-anchor="middle"
                                                  (click)="onClickSkillTreeNode(node.key, playerIndex)"
                                                  matTooltip="{{getSkillTreeNodeTooltip(node.key)}}"
                                                  [matTooltipClass]="'myMatTooltip'"
                                                  >{{node.value}}/{{node.key.levels.length}}</text>
                                        </g>
                                    </svg>
                                </div>
                                <div class="divContainerSkillTreeButtons">
                                    <button class="buttonSkillTreeControl" mat-raised-button color="accent" (click)="onClickButtonLearnAllLessonsScrolls(playerIndex)">Learn all lessons (scrolls only)</button>
                                    <button class="buttonSkillTreeControl" mat-raised-button color="accent" (click)="onClickButtonLearnAllLessons(playerIndex)">Learn all lessons</button>
                                    <button class="buttonSkillTreeControl" mat-raised-button color="accent" (click)="onClickButtonResetSkillTree(playerIndex)">Reset skill tree</button>
                                    <p>Costs: {{ skillTrees[playerIndex].getCostsString() }}</p>
                                </div>
                                
                                <div class="divSettingsOutputWizardStats">
                                    <h2 class="mat-h2">Stats:</h2>
                                    <div *ngFor="let stat of skillTrees[playerIndex].toWizardStats() | keyvalue">
                                        <span *ngIf="isValidStatForClass(stat.key, playerIndex)">
                                            {{formatUserFriendlyStat(stat.key)}}: {{stat.value.toFixed(2)}}
                                        </span>   
                                    </div>
                                    
                                    <h2 class="mat-h2">Conditional buffs:</h2>
                                    <div>
                                        <ul>
                                            <li *ngFor="let skillTreeNode of skillTrees[playerIndex].toStudiedTriggers(false)">
                                                <b>{{skillTreeNode.name}}</b>: {{skillTreeNode.statChangeDescription}} (+{{skillTreeNode.levels[0].statChange.toFixed(2)}})
                                            </li>
                                        </ul>
                                    </div>
                                    
                                </div>
            
                                <div class="divSettingsPotions">
                                    <p>
                                        Potions (brew time: {{getPotionsBrewTimeRaw(simParameters.potions[playerIndex])}},
                                        with master notes: {{getPotionsBrewTimeMasterNotes(simParameters.potions[playerIndex])}}):
                                        
                                    </p>
                                    <form class="potionsForm">
                                        <mat-form-field class="inputPotion">
                                            <input type="number" min="0" matInput placeholder="Regular exstimulo" name="exstimulo"
                                                   [(ngModel)]="simParameters.potions[playerIndex].nExstimuloAvailable">
                                        </mat-form-field>
                                        <mat-form-field class="inputPotion">
                                            <input type="number" min="0" matInput placeholder="Strong exstimulo" name="strongExstimulo"
                                                   [(ngModel)]="simParameters.potions[playerIndex].nStrongExstimuloAvailable">
                                        </mat-form-field>
                                        <mat-form-field class="inputPotion">
                                            <input type="number" min="0" matInput placeholder="Potent exstimulo" name="potentExstimulo"
                                                    [(ngModel)]="simParameters.potions[playerIndex].nPotentExstimuloAvailable">
                                        </mat-form-field>
                                        <mat-form-field class="inputPotion">
                                            <input type="number" min="0" matInput placeholder="Wit Sharpening" name="witSharpening"
                                                    [(ngModel)]="simParameters.potions[playerIndex].nWitSharpeningAvailable">
                                        </mat-form-field>
                                        <mat-form-field class="inputPotion">
                                            <input type="number" min="0" matInput placeholder="Weak Invigoration" name="weakInvigoration"
                                                    [(ngModel)]="simParameters.potions[playerIndex].nWeakInvigorationAvailable">
                                        </mat-form-field>
                                        <mat-form-field class="inputPotion">
                                            <input type="number" min="0" matInput placeholder="Strong Invigoration" name="strongInvigoration"
                                                    [(ngModel)]="simParameters.potions[playerIndex].nStrongInvigorationAvailable">
                                        </mat-form-field>
                                        <mat-form-field class="inputPotion">
                                            <input type="number" min="0" matInput placeholder="Health" name="health"
                                                    [(ngModel)]="simParameters.potions[playerIndex].nHealingPotionsAvailable">
                                        </mat-form-field>
                                    </form>
                                </div>
                                <br>
                                <div class="divSettingsRunestoneLevel">
                                    <p>Runestone level:</p>
                                    <mat-form-field class="inputPotion">
                                        <input type="number" matInput placeholder="Runestone level" name="runestoneLevel"
                                                    [(ngModel)]="simParameters.runestoneLevels[playerIndex]">
                                    </mat-form-field>
                                </div>

                                
                                <div *ngIf="simAdvancedSettings.showPlayerRules" class="divSettingsPlayerRules">
                                    <mat-expansion-panel [expanded]="false">
                                        <mat-expansion-panel-header>
                                            <mat-panel-title>
                                                Player AI
                                            </mat-panel-title>
                                            <mat-panel-description>
                                                Rules that determine the player AI's next action
                                            </mat-panel-description>
                                        </mat-expansion-panel-header>
                                        <div class="divPlayerRulesContainer">
                                            <table mat-table matSort [dataSource]="getPlayerRulesForTable(playerIndex)" 
                                                   class="mat-elevation-z8"
                                                   multiTemplateDataRows>
                                                
                                                <ng-container matColumnDef="priority">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Priority </th>
                                                        <td mat-cell *matCellDef="let rule"> {{rule.priority}} </td>
                                                </ng-container>
                                                <ng-container matColumnDef="event.type">
                                                        <th mat-header-cell *matHeaderCellDef mat-sort-header> Action </th>
                                                        <td mat-cell *matCellDef="let rule"> {{formatUserFriendlyStat(rule.event.type)}} </td>
                                                </ng-container>

                                                <ng-container matColumnDef="expandedRuleColumn">
                                                    <td mat-cell *matCellDef="let rule" [attr.colspan]="columnNamesPlayerRules.length">
                                                        <div class="rule-detail"
                                                            [@detailExpand]="rule == expandedRule ? 'expanded' : 'collapsed'">

                                                            <div class="rule-detail-inner-container">
                                                                <mat-form-field class="inputRulePriority">
                                                                        <mat-label>Priority</mat-label>
                                                                        <input matInput type="number" placeholder="Priority" [(ngModel)]="rule.priority">
                                                                    </mat-form-field>
                                                                    <mat-form-field class="inputRuleAction">
                                                                        <mat-label>Action</mat-label>
                                                                        <mat-select placeholder="Action" name="selectRuleType" 
                                                                                [(ngModel)]="rule.event.type">
                                                                            <mat-option *ngFor="let action of getActionNameMap(playerIndex) | keyvalue" 
                                                                                        value="{{action.key}}">{{action.value}}</mat-option>
                                                                        </mat-select>
                                                                    </mat-form-field><br>
                                                                    
                                                                    <h3 class="mat-h3">Conditions (total: {{rule.conditions.all.length}})</h3>
                                                                    <app-rule-detail-component [conditionGroup]="rule.conditions.all"
                                                                        [ruleConditionGroupName]="'all'"
                                                                        [depth]="0"
                                                                        [parentConditionGroup]="rule.conditions.all" [parentConditionGroupIndex]="0"
                                                                    ></app-rule-detail-component> 
                                                                    
                                                                    <button class="buttonSkillTreeControl" mat-raised-button color="accent" 
                                                                        (click)="onClickRemoveRule(playerIndex, rule)"
                                                                        class="buttonRemoveRule">Remove rule</button>
                                                                
                                                            </div> 
                                                            
                                                        </div>
                                                    </td>
                                                </ng-container>
                            
                                                <tr mat-header-row *matHeaderRowDef="columnNamesPlayerRules"></tr>
                                                <tr mat-row *matRowDef="let rule; columns: columnNamesPlayerRules;"
                                                    class="rule-row rule-row-static"
                                                    [class.rule-row]="expandedRule === rule"
                                                    (click)="expandedRule = expandedRule === rule ? null : rule">
                                                 </tr>
                                                 <tr mat-row *matRowDef="let row; columns: ['expandedRuleColumn']" class="expandedRule-row"></tr>
                                            </table>
                                            

                                            <button class="buttonSkillTreeControl" mat-raised-button color="accent" (click)="onClickResetPlayerRules(playerIndex)">Reset rules to default</button>
                                            <button class="buttonSkillTreeControl" mat-raised-button color="accent" (click)="onClickRemovePlayerRules(playerIndex)">Remove all rules</button><br>

                                            <mat-form-field class="inputPotion">
                                                <mat-label>Author</mat-label>
                                                <input matInput type="text" placeholder="Author" [(ngModel)]="simParameters.ruleContainers[playerIndex].author">
                                            </mat-form-field>
                                            <button class="buttonSkillTreeControl" mat-raised-button color="accent" (click)="onClickExportPlayerRules(playerIndex)">Export rules (JSON)</button>
                                            
                                        </div> 
                                    </mat-expansion-panel>
                                </div> 
                                
            
                                <br>
                                <button id="buttonRemoveWizard" mat-raised-button (click)="onClickRemoveWizard(playerIndex)">Remove wizard</button>
                            </div>
                            <div *ngIf="simParameters.nameClasses.length<5" class="divSingleWizardSettings">
                                <button id="buttonAddWizard"  mat-raised-button (click)="onClickAddWizard($event)" matTooltip="Add another wizard" >Add wizard</button> 
                            </div>
            
                        </div>
                    </mat-tab>
                    <mat-tab [disabled]="true" label="Direct stats"> 
            
                    </mat-tab>
                </mat-tab-group>
        </mat-expansion-panel>

        <mat-expansion-panel #matPanelAdvancedSimulationSettings [expanded]="false">
            <mat-expansion-panel-header>
                <mat-panel-title>
                    Advanced simulation settings
                </mat-panel-title>
                <mat-panel-description>
                    Seed, number of simulations...
                </mat-panel-description>
            </mat-expansion-panel-header>
        
            <mat-form-field class="inputAdvancedSetting">
                <mat-label>Seed: This will ensure reproducible results. For multiple simulations, the seed will increased by 1 for each simulation. </mat-label>
                <input matInput type="number" placeholder="Seed" [(ngModel)]="simParameters.seed" [(value)]="simParameters.seed">
            </mat-form-field>
            <br>
            <mat-form-field class="inputAdvancedSetting">
                <mat-label>Number of simulations: For example, when comparing room level, will run each room level this many times (with different seeds). </mat-label>
                <input matInput type="number" min="1" placeholder="Number of simulations" [(ngModel)]="simAdvancedSettings.numberSimulationsPerSetting">
            </mat-form-field>
            <mat-form-field class="inputAdvancedSetting">
                <mat-label>Seconds between simulations: This field is only used for calculating challenge XP rewards per hour. </mat-label>
                <input matInput type="number" min="1" placeholder="Seconds between simulations" [(ngModel)]="simAdvancedSettings.secondsBetweenSimulations">
            </mat-form-field>
            <mat-checkbox [(ngModel)]="simAdvancedSettings.showPlayerRules">Show player AI rules in wizard settings</mat-checkbox><br>
            <mat-checkbox [(ngModel)]="simAdvancedSettings.runParallel" [disabled]="true">Run parallel</mat-checkbox>
            
            <div class="divContainerSkillTreeButtons">
                <button class="buttonSkillTreeControl" id="buttonImportDataFromFile"  mat-raised-button  (click)="importDataFromFile()">Import data from file</button>
                <button class="buttonSkillTreeControl" id="buttonExportDataToFile" mat-raised-button (click)="exportDataToFile()">Export data as file</button>
                <button class="buttonSkillTreeControl" id="buttonExportDataToFile" mat-raised-button color="accent" (click)="resetAllData()">Reset all data</button>
            </div>

        </mat-expansion-panel>

        <mat-expansion-panel #matPanelSimulationResults class="matPanelSimulationResultsClass">
            <mat-expansion-panel-header>
                <mat-panel-title>
                    Simulation results
                </mat-panel-title>
                <mat-panel-description>
                    Results of your simulation appear here
                </mat-panel-description>
            </mat-expansion-panel-header>

            <div #divContainerSingleSimulation *ngIf="simAdvancedSettings.simGoal ==='single' && simulationSingleResults !== null">
                <div #divContainerSingleSimulationLog>
                    <h2 class="mat-h2">Overall simulation results: </h2>
                    Real world time passed: {{(simulationSingleResults.durationWallTimeMS / 1000).toFixed(3)}}s <br>
                    Simulation time: {{simulationSingleResults.durationGameTimeMS / 1000}}s <br>
                    <!-- Number of events: {{simulationSingleResults.nEvents}} <br> -->
                    Room level: {{getChamberName(simulationSingleResults.simParameters.roomLevel)}} <br>
                    {{simulationSingleResults.isWin === false ? 'Challenge was not won.' : 'Challenge was won!'}}<br>
                    
                    <div class="divSimulationSingleResultAllEnemies">
                        <h2 class="mat-h2">Enemies: </h2>
                        <div class="divSimulationSingleResultCombatant divSimulationSingleResultEnemy" *ngFor="let enemy of simulationSingleResults.enemies">
                            <div class="divEnemyPortraitContainer">
                                <img src="assets/img/enemies/{{enemy.name}}.png" />
                            </div>
                            {{ enemy.nameUserFriendly }}
                            ({{ enemy.level }})
                            <mat-progress-bar mode="determinate" color="warn" 
                                 [value]="enemy.currentStamina  / enemy.maxStamina *100"></mat-progress-bar>
                            <span class="spanEnemyDifficultyStar" *ngFor="let difficulty of [].constructor(enemy.difficulty)">★</span>
                            <span class="spanEnemyDifficultyStar" *ngFor="let difficulty of [].constructor(5-enemy.difficulty)">☆</span>
                            <div class="divSimulationSingleResultAllCombatantBuffs">
                                <div class="divSimulationSingleResultCombatantBuff">
                                    <img src="assets/img/deteriorationHex.png" *ngIf="enemy.hasDeteriorationHex"
                                        matTooltip="Deterioration hex damage: {{enemy.deteriorationHexDamage}}"
                                        [matTooltipClass]="'myMatTooltip'"
                                    />
                                </div>
                                <div class="divSimulationSingleResultCombatantBuff">
                                    <img src="assets/img/confusionHex.png" *ngIf="enemy.hasConfusionHex" 
                                        matTooltip="Confusion hex (-defence, -defence breach, -dodge): {{enemy.confusionHexValue}}"
                                        [matTooltipClass]="'myMatTooltip'"
                                    />
                                </div>
                                <div class="divSimulationSingleResultCombatantBuff">
                                    <img src="assets/img/weakeningHex.png" *ngIf="enemy.hasWeakeningHex" 
                                        matTooltip="Weakening hex (-power): {{enemy.weakeningHexValue}}"
                                        [matTooltipClass]="'myMatTooltip'"
                                    />
                                </div>
                                        
                            </div>
                        </div>
                    </div>

                    <div class ="divSimulationSingleResultAllWizards">
                        <h2 class="mat-h2">Players: </h2>
                        <div class="divSimulationSingleResultCombatant divSimulationSingleResultWizard"
                             *ngFor="let wizardResult of simulationSingleResults.wizardResults">
                            <b>Player {{wizardResult.playerIndex+1}} </b>
                            ({{ simulationSingleResults.wizards[wizardResult.playerIndex].nameClassUserFriendly }})<br>

                            <!-- 
                            <mat-progress-bar mode="determinate" color="warn" 
                                              [value]="simulationSingleResults.wizards[wizardResult.playerIndex].currentStaminaPercent*100"></mat-progress-bar>
                            -->
                            {{wizardResult.numberOfCasts}} hits ({{wizardResult.numberOfCriticalCasts}} critical, {{wizardResult.numberOfDodgedCasts}} dodged)<br>
                            {{wizardResult.averageDamage.toFixed(2)}} average damage<br>
                            {{wizardResult.totalDamage}} total damage<br>
                            {{(wizardResult.timeSpentDefeated/1000).toFixed(0)}}s spent defeated<br>
                            {{wizardResult.challengeXPReward}} challenge XP (runestone level {{wizardResult.runestoneLevel}})
                            <div class="divSimulationSingleResultAllCombatantBuffs">
                                <div class="divSimulationSingleResultCombatantBuff">
                                    <img src="assets/img/defenceCharm.png" 
                                         *ngIf="simulationSingleResults.wizards[wizardResult.playerIndex].hasDefenceCharm"
                                         matTooltip="Defence charm: +{{(simulationSingleResults.wizards[wizardResult.playerIndex].defenceCharmValue*100).toFixed(0)}}% defence"
                                        [matTooltipClass]="'myMatTooltip'" />
                                </div>
                                <div class="divSimulationSingleResultCombatantBuff">
                                    <img src="assets/img/proficiencyCharm.png" 
                                         *ngIf="simulationSingleResults.wizards[wizardResult.playerIndex].hasProficiencyPowerCharm"
                                         matTooltip="Proficiency power charm: +{{(simulationSingleResults.wizards[wizardResult.playerIndex].proficiencyPowerCharmValue*100).toFixed(0)}}% proficiency"
                                         [matTooltipClass]="'myMatTooltip'" />
                                </div>
                                <div class="divSimulationSingleResultCombatantBuff">
                                    <img src="assets/img/braveryCharm.png" 
                                         *ngIf="simulationSingleResults.wizards[wizardResult.playerIndex].hasBraveryCharm" />
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            
            <div #divContainerMultipleSimulations *ngIf="simAdvancedSettings.simGoal.indexOf('multiple') !== -1">
                <div *ngIf="simProgress !== null">
                    Simulation progress: {{ simProgress.nFinished }} / {{ simProgress.nTotal }}
                    <mat-progress-bar mode="determinate" [value]="simProgress.nFinished / simProgress.nTotal *100"></mat-progress-bar>
                </div>
                <div id="divContainerMultipleSimulationsTable" *ngIf="simProgress === null">
                    <table #tableMultipleSimulationResults mat-table matSort [dataSource]="simulationMultipleResultsGrouped" class="mat-elevation-z8">

                        
                            <ng-container matColumnDef="groupByValue">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header> {{simGoalMap[simAdvancedSettings.simGoal]}} </th>
                                <td mat-cell *matCellDef="let row"> {{row.groupByValue}} </td>
                            </ng-container>
                            <!-- <ng-container matColumnDef="roomLevel">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Room level </th>
                                    <td mat-cell *matCellDef="let row"> {{row.roomLevel}} </td>
                            </ng-container> -->
                            <ng-container matColumnDef="winPercentage">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Win % </th>
                                    <td mat-cell *matCellDef="let row"> {{row.winPercentage.toFixed(2)}} </td>
                            </ng-container>
                            <ng-container matColumnDef="averageNumberOfCasts">
                                    <th mat-header-cell *matHeaderCellDef> Average energy (casts)</th>
                                    <td mat-cell *matCellDef="let row"> {{row.averageNumberOfCasts.toFixed(2)}} </td>
                            </ng-container>
                            <ng-container matColumnDef="averageDamage">
                                    <th mat-header-cell *matHeaderCellDef> Average damage </th>
                                    <td mat-cell *matCellDef="let row"> {{row.averageDamage.toFixed(2)}} </td>
                            </ng-container>
                            <ng-container matColumnDef="averageCritPercent">
                                    <th mat-header-cell *matHeaderCellDef> Crit % </th>
                                    <td mat-cell *matCellDef="let row"> {{row.averageCritPercent.toFixed(2)}} </td>
                            </ng-container>
                            <ng-container matColumnDef="averageDodgePercent">
                                    <th mat-header-cell *matHeaderCellDef> Dodge % </th>
                                    <td mat-cell *matCellDef="let row"> {{row.averageDodgePercent.toFixed(2)}} </td>
                            </ng-container>
                            <ng-container matColumnDef="averageTotalDamage">
                                    <th mat-header-cell *matHeaderCellDef> Average total damage </th>
                                    <td mat-cell *matCellDef="let row"> {{row.averageTotalDamage.toFixed(2)}} </td>
                            </ng-container>
                            <ng-container matColumnDef="averageGameTimeMS">
                                    <th mat-header-cell *matHeaderCellDef> Average time </th>
                                    <td mat-cell *matCellDef="let row"> {{(row.averageGameTimeMS / 1000).toFixed(0)}}s </td>
                            </ng-container>
                            <ng-container matColumnDef="averageChallengeXPReward">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header> Reward </th>
                                    <td mat-cell *matCellDef="let row"> {{row.averageChallengeXPReward}} CXP </td>
                            </ng-container>
                            <ng-container matColumnDef="averageRunsPerHour">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header> Runs per hour </th>
                                <td mat-cell *matCellDef="let row"> {{row.averageRunsPerHour.toFixed(1) }} runs/hour </td>
                            </ng-container>
                            <ng-container matColumnDef="averageChallengeXPRewardPerHour">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header> Rewards per hour </th>
                                <td mat-cell *matCellDef="let row"> {{row.averageChallengeXPRewardPerHour.toFixed(0) }} CXP/hour </td>
                            </ng-container>
                            <ng-container matColumnDef="averageCastsPerHour">
                                <th mat-header-cell *matHeaderCellDef mat-sort-header> Energy per hour </th>
                                <td mat-cell *matCellDef="let row"> {{row.averageCastsPerHour.toFixed(0) }} energy/hour </td>
                            </ng-container>
                            <ng-container matColumnDef="numberOfRuns">
                                    <th mat-header-cell *matHeaderCellDef> Runs simulated </th>
                                    <td mat-cell *matCellDef="let row"> {{row.numberOfRuns}} </td>
                            </ng-container>
        
                            <tr mat-header-row *matHeaderRowDef="columnNamesMultipleSimulationsResultsGrouped"></tr>
                            <tr mat-row *matRowDef="let row; columns: columnNamesMultipleSimulationsResultsGrouped;"></tr>
                        </table>
                </div>
                
            </div>

            <br>
            <div id="divContainerSimulationLog">
                <h2 class="mat-h2">Simulation log: </h2>
                <mat-form-field id="selectLogChannelInput"  class="inputAdvancedSetting">
                    <mat-select placeholder="Select log channel" name="selectLogChannel" 
                                                    [(ngModel)]="simAdvancedSettings.simulationLogChannel"
                                                    class="inputPotion">
                                                    
                        <mat-option *ngFor="let item of simulationLogChannelStore | keyvalue" 
                                    value="{{item.key}}">{{item.key}}</mat-option>
                    </mat-select>
                </mat-form-field> 
                <textarea matInput id="inputSimulationLog" type="text" disabled="true" 
                        placeholder="Simulation log" 
                        [(value)]="simulationLogChannelStore[simAdvancedSettings.simulationLogChannel]"></textarea>
            </div>
            
           

        </mat-expansion-panel>

    </mat-accordion>

</div> <!-- end div container -->






<router-outlet></router-outlet>